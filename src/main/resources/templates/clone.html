<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CloneXpert — Clonagem de Sites Profissional</title>
    <link rel="shortcut icon" th:href="@{/3.png}" type="image/x-icon">

    <!-- Importando Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Ícones do Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <style>
        /* Estilo básico e fontes */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4ff, #d9e4ff);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            color: #222;
        }
        /* Barra de navegação */
        nav.navbar {
            background: #3b82f6;
            box-shadow: 0 2px 8px rgb(59 130 246 / 0.3);
            position: sticky;
            top: 0;
            z-index: 1030;
            padding: 0.75rem 1.5rem;
        }
        nav.navbar .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: white;
            letter-spacing: 1px;
            user-select: none;
            text-shadow: 0 1px 3px rgb(0 0 0 / 0.3);
        }
        nav.navbar .btn-back {
            border: 2px solid white;
            border-radius: 12px;
            padding: 0.35rem 0.85rem;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.35rem;
            text-decoration: none;
            transition: background-color 0.3s ease, color 0.3s ease;
            user-select: none;
        }
        nav.navbar .btn-back:hover, nav.navbar .btn-back:focus {
            background-color: white;
            color: #3b82f6;
            text-decoration: none;
        }

        /* Conteúdo principal */
        main {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 1rem;
        }
        /* Card */
        .card {
            width: 100%;
            max-width: 520px;
            border-radius: 16px;
            box-shadow: 0 12px 30px rgb(59 130 246 / 0.2);
            background: #ffffffcc;
            backdrop-filter: saturate(180%) blur(12px);
            padding: 2.5rem 2rem 3rem;
            transition: box-shadow 0.3s ease;
        }
        .card:hover { box-shadow: 0 16px 45px rgb(59 130 246 / 0.35); }
        /* Botões */
        .btn-primary {
            background-color: #3b82f6;
            border: none;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgb(59 130 246 / 0.4);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
        }
        .btn-primary:hover, .btn-primary:focus {
            background-color: #2563eb;
            box-shadow: 0 8px 22px rgb(37 99 235 / 0.6);
        }
        .btn-success {
            background-color: #22c55e;
            border: none;
            font-weight: 600;
            padding: 0.65rem 1.4rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            box-shadow: 0 5px 13px rgb(34 197 94 / 0.45);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
            color: white;
        }
        .btn-success:hover, .btn-success:focus {
            background-color: #15803d;
            box-shadow: 0 8px 20px rgb(21 128 61 / 0.7);
            text-decoration: none;
            color: white;
        }
        small.form-text {
            color: #4b5563;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: block;
            user-select: none;
        }
        @media (max-width: 576px) {
            .download-group { flex-direction: column; gap: 1rem; }
            .btn-success { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<!-- Barra de navegação -->
<nav class="navbar navbar-expand-lg">
    <div class="container d-flex justify-content-between align-items-center">
        <a class="navbar-brand" href="#">CloneXpert</a>
        <a href="/panel" class="btn-back" aria-label="Voltar ao painel">
            <i class="bi bi-arrow-left-circle"></i> Voltar
        </a>
    </div>
</nav>

<!-- Conteúdo principal -->
<main role="main">
    <section class="card">
        <h1>Clonar Site</h1>

        <!-- Formulário -->
        <form th:action="@{/clone}" method="post" class="needs-validation" novalidate>
            <div class="mb-4">
                <label for="url">URL do site</label>
                <input type="url" class="form-control" id="url" name="url" placeholder="https://exemplo.com" th:value="${url}" required />
                <small class="form-text">Informe a URL completa do site, começando por <code>http://</code> ou <code>https://</code>.</small>
                <div class="invalid-feedback">Por favor, informe uma URL válida.</div>
            </div>
            <div class="mb-4">
                <label for="depth">Profundidade</label>
                <input type="number" class="form-control" id="depth" name="depth" min="1" max="5" th:value="${depth}" required />
                <small class="form-text">Número de níveis de links internos para seguir (1 a 5).</small>
                <div class="invalid-feedback">Informe um valor entre 1 e 5.</div>
            </div>
            <div class="mb-4">
                <label for="mode">Modo de clonagem</label>
                <select id="mode" name="mode" class="form-select" th:value="${mode}">
                    <option value="static" th:selected="${mode == 'static'}">Static</option>
                    <option value="headless" th:selected="${mode == 'headless'}">Headless</option>
                </select>
                <small class="form-text">
                    <strong>Static:</strong> baixa arquivos estáticos (HTML, CSS, JS, imagens). Mais rápido e econômico.<br/>
                    <strong>Headless:</strong> simula navegador real para conteúdo dinâmico. Mais preciso, porém mais caro.
                </small>
            </div>
            <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" id="allowExternal" name="allowExternal" th:checked="${allowExternal}" />
                <label class="form-check-label" for="allowExternal">Permitir links externos</label>
                <small class="form-text">Ative para que o clone siga links para domínios externos ao site original.</small>
            </div>
            <div class="download-group d-flex gap-3 align-items-center">
                <button class="btn btn-primary flex-grow-1" type="button" id="btnOpenModal" aria-label="Iniciar clonagem do site">Iniciar Clonagem</button>
                <a th:if="${jobId != null}" th:href="@{'/api/v1/download/' + ${jobId}}" class="btn btn-success" download aria-label="Baixar arquivo ZIP da clonagem">
                    <i class="bi bi-download"></i> Baixar ZIP
                </a>
            </div>
        </form>

        <!-- Status -->
        <div class="mt-4">
            <div th:if="${jobId != null}" class="alert alert-success" role="alert">Clonagem iniciada! Job ID: <strong th:text="${jobId}"></strong></div>
            <div th:if="${error != null}" class="alert alert-danger" role="alert">Erro: <span th:text="${error}"></span></div>
        </div>
    </section>
</main>

<!-- Modal detalhado -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Confirmar Clonagem</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" id="modalMessage"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmClone">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<!-- Botão WhatsApp -->
<a href="https://wa.me/5511999999999" target="_blank"
   style="position: fixed; bottom: 20px; right: 20px; background-color: #25D366; color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; font-size: 30px;">
    <i class="bi bi-whatsapp"></i>
</a>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (() => {
        'use strict';
        const form = document.querySelector('.needs-validation');
        const btnOpenModal = document.getElementById('btnOpenModal');
        const modalMessage = document.getElementById('modalMessage');
        const btnConfirmClone = document.getElementById('btnConfirmClone');

        btnOpenModal.addEventListener('click', () => {
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            const url = document.getElementById('url').value;
            const depth = document.getElementById('depth').value;
            const mode = document.getElementById('mode').value;
            const allowExternal = document.getElementById('allowExternal').checked;

            let valor = mode === 'static' ? 10 : 20;
            let explicacaoModo =
                mode === 'static'
                    ? "Modo Static: baixa e salva apenas arquivos estáticos (HTML, CSS, JS e imagens). Mais rápido e barato."
                    : "Modo Headless: simula um navegador real, captura conteúdo dinâmico carregado por JavaScript. Mais preciso, porém mais caro.";
            let explicacaoExternal =
                allowExternal
                    ? "Links externos: ATIVADO — seguirá links para outros domínios além do principal."
                    : "Links externos: DESATIVADO — ficará restrito ao domínio original.";

            modalMessage.innerHTML = `
            <p><strong>URL:</strong> ${url}</p>
            <p><strong>Profundidade:</strong> ${depth} — número de níveis de links internos a seguir.</p>
            <p><strong>Modo:</strong> ${mode.toUpperCase()} (${valor} créditos) <br><small>${explicacaoModo}</small></p>
            <p><strong>Links externos:</strong> ${allowExternal ? "Sim" : "Não"} <br><small>${explicacaoExternal}</small></p>
            <hr>
            <p><strong>Total de créditos:</strong> ${valor}</p>
        `;
            const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
            modal.show();
        });

        btnConfirmClone.addEventListener('click', () => {
            form.submit();
        });
    })();
</script>
</body>
</html>